# 朋友圈拼图工具

一个将多张图片垂直拼接成长图的Python工具，支持命令行和图形界面两种模式。

## 功能特点

- ✅ **自动宽度适配**：自动找到最短横边，所有图片统一压缩到该宽度
- ✅ **批量处理**：支持大量图片的批量拼接
- ✅ **灵活分组**：可自定义每组图片数量
- ✅ **图形界面**：提供直观的PyQt5图形界面
- ✅ **拖拽支持**：支持文件和文件夹拖拽
- ✅ **实时预览**：处理进度实时显示
- ✅ **清理工具**：内置文件夹清理功能

## 安装

### 1. 克隆项目
```bash
git clone [项目地址]
cd 拼图bot
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

## 使用方法

### 图形界面模式（推荐）

运行图形界面程序：
```bash
python gui_stitcher.py
```

界面功能：
- **智能分组系统**：支持自动分组和拖拽重新分组
- **图片缩略图预览**：显示所有图片的缩略图预览，悬停显示完整信息
- **选择输入目录**：选择包含待处理图片的文件夹
- **选择输出目录**：选择保存拼接结果的文件夹
- **每组图片数量**：设置每组拼接的图片数量（默认9张）
- **拖拽支持**：支持拖拽图片或文件夹到界面
- **实时日志**：显示处理进度和详细信息
- **一键清理**：快速清空输出目录
- **全选/取消全选**：快速选择或取消选择所有图片

### 命令行模式

#### 交互式命令行
```bash
python image_stitcher.py
```
按照提示输入参数即可。

#### 命令行参数（V1.0.0，现已弃用）
```bash
python image_stitcher.py -i input_folder -o output_folder -n 9
```

### 文件夹清理工具

运行清理工具：
```bash
python clean_folders.py
```

提供交互式菜单：
1. 清空input文件夹
2. 清空output文件夹
3. 清空两个文件夹
4. 退出

## 支持的图片格式

- JPG/JPEG
- PNG
- BMP
- TIFF
- WebP

## 使用示例

### 图形界面使用步骤：

1. 运行 `python gui_stitcher.py`
2. 选择输入目录，所有图片将显示在"未分组图片"区域
3. 设置每组图片数量（如9张），点击"自动分组"自动创建分组
4. 或手动拖拽图片到不同分组进行自定义分组
5. 每个分组可以清空重新分配
6. 确认分组无误后点击"开始拼图"
7. 处理完成后自动打开输出目录

### 命令行使用示例：
```bash
# 使用图形界面
python gui_stitcher.py

# 使用命令行交互模式
python image_stitcher.py

# 清理文件夹
python clean_folders.py
```

## 项目结构

```
拼图bot/
├── gui_stitcher.py      # 图形界面主程序
├── image_stitcher.py    # 命令行版本
├── clean_folders.py     # 文件夹清理工具
├── requirements.txt     # 依赖列表
├── README.md           # 说明文档
├── input/              # 默认输入目录
└── output/             # 默认输出目录
```

## 工作原理

### 图片处理算法

1. **宽度统一**：程序会扫描所有输入图片，找到最短的横边宽度作为基准宽度
2. **等比例缩放**：所有图片按相同比例缩放到基准宽度，保持宽高比不变
3. **垂直拼接**：将缩放后的图片按顺序垂直排列，形成长图
4. **质量保持**：使用Lanczos重采样算法确保图片质量，输出JPEG格式（质量95%）

### 分组机制

- **智能分组**：根据设定的每组图片数量自动创建分组
- **拖拽重排**：支持通过拖拽方式重新调整图片分组
- **批量处理**：每个分组独立处理，生成对应的长图文件

### 内存优化

- **流式处理**：逐张处理图片，避免同时加载大量图片到内存
- **缓存机制**：缩略图缓存，避免重复生成
- **后台线程**：使用QThread在后台处理，界面保持响应

## 注意事项

1. **图片质量**：程序会自动将所有图片压缩到最短横边宽度，保持宽高比
2. **内存使用**：处理大量图片时，请确保系统有足够内存
3. **输出格式**：输出为JPEG格式，质量设置为95%
4. **文件命名**：输出文件名为 `stitched_long_image.jpg` 或 `stitched_long_image_partX.jpg`

## 故障排除

### 常见问题

**Q: 程序无法启动**
- 确保已安装所有依赖：`pip install -r requirements.txt`
- 检查Python版本是否为3.6+

**Q: 找不到图片文件**
- 确认图片格式是否为支持的格式
- 检查输入目录是否正确

**Q: 处理中断**
- 检查磁盘空间是否充足
- 确认图片文件未损坏

**Q: 内存不足**
- 减少每组图片数量
- 分批处理大量图片

## 技术栈

- **Python 3.6+**
- **Pillow** - 图片处理
- **PyQt5** - 图形界面
- **pathlib** - 路径处理

## 更新日志

### v2.0.0
- ✅ 新增图形界面（PyQt5）
- ✅ 支持拖拽文件和文件夹
- ✅ 实时进度显示
- ✅ 一键清理功能
- ✅ 文件夹清理工具

### v1.0.0
- ✅ 基础拼图功能
- ✅ 自动宽度适配
- ✅ 批量处理支持
- ✅ 交互式命令行